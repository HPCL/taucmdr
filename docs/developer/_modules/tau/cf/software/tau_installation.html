<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tau.cf.software.tau_installation &mdash; TAU Commander Developer Documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="top" title="TAU Commander Developer Documentation" href="../../../../index.html" />
    <link rel="up" title="tau.cf.software" href="../software.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><img class="rightlogo" src="../../../../_static/taulogo-large.png" alt="Logo"/><h1 class="heading"><a href="../../../../index.html">
          <span>TAU Commander Developer Documentation</span></a></h1>
        <h2 class="heading"><span>tau.cf.software.tau_installation</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for tau.cf.software.tau_installation</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># Copyright (c) 2015, ParaTools, Inc.</span>
<span class="c"># All rights reserved.</span>
<span class="c">#</span>
<span class="c"># Redistribution and use in source and binary forms, with or without</span>
<span class="c"># modification, are permitted provided that the following conditions are met:</span>
<span class="c"># (1) Redistributions of source code must retain the above copyright notice,</span>
<span class="c">#     this list of conditions and the following disclaimer.</span>
<span class="c"># (2) Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="c">#     this list of conditions and the following disclaimer in the documentation</span>
<span class="c">#     and/or other materials provided with the distribution.</span>
<span class="c"># (3) Neither the name of ParaTools, Inc. nor the names of its contributors may</span>
<span class="c">#     be used to endorse or promote products derived from this software without</span>
<span class="c">#     specific prior written permission.</span>
<span class="c">#</span>
<span class="c"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="c"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="c"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="c"># DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span>
<span class="c"># FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="c"># DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="c"># SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="c"># CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<span class="c"># OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="c"># OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c">#</span>
<span class="sd">&quot;&quot;&quot;TAU software installation management.</span>

<span class="sd">TAU is the core software package of TAU Commander.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">tau</span> <span class="kn">import</span> <span class="n">logger</span><span class="p">,</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">tau.error</span> <span class="kn">import</span> <span class="n">ConfigurationError</span><span class="p">,</span> <span class="n">InternalError</span>
<span class="kn">from</span> <span class="nn">tau.cf.software</span> <span class="kn">import</span> <span class="n">SoftwarePackageError</span>
<span class="kn">from</span> <span class="nn">tau.cf.software.installation</span> <span class="kn">import</span> <span class="n">Installation</span><span class="p">,</span> <span class="n">parallel_make_flags</span>
<span class="kn">from</span> <span class="nn">tau.cf.software.pdt_installation</span> <span class="kn">import</span> <span class="n">PdtInstallation</span>
<span class="kn">from</span> <span class="nn">tau.cf.software.binutils_installation</span> <span class="kn">import</span> <span class="n">BinutilsInstallation</span>
<span class="kn">from</span> <span class="nn">tau.cf.software.libunwind_installation</span> <span class="kn">import</span> <span class="n">LibunwindInstallation</span>
<span class="kn">from</span> <span class="nn">tau.cf.software.papi_installation</span> <span class="kn">import</span> <span class="n">PapiInstallation</span>
<span class="kn">from</span> <span class="nn">tau.cf.compiler</span> <span class="kn">import</span> <span class="n">SYSTEM_COMPILERS</span><span class="p">,</span> <span class="n">GNU_COMPILERS</span><span class="p">,</span> <span class="n">INTEL_COMPILERS</span><span class="p">,</span> <span class="n">PGI_COMPILERS</span>
<span class="kn">from</span> <span class="nn">tau.cf.compiler</span> <span class="kn">import</span> <span class="n">CC_ROLE</span><span class="p">,</span> <span class="n">CXX_ROLE</span><span class="p">,</span> <span class="n">FC_ROLE</span><span class="p">,</span> <span class="n">UPC_ROLE</span>
<span class="kn">from</span> <span class="nn">tau.cf.compiler.mpi</span> <span class="kn">import</span> <span class="n">SYSTEM_MPI_COMPILERS</span><span class="p">,</span> <span class="n">INTEL_MPI_COMPILERS</span>
<span class="kn">from</span> <span class="nn">tau.cf.compiler.mpi</span> <span class="kn">import</span> <span class="n">MPI_CC_ROLE</span><span class="p">,</span> <span class="n">MPI_CXX_ROLE</span><span class="p">,</span> <span class="n">MPI_FC_ROLE</span>
<span class="kn">from</span> <span class="nn">tau.cf.target</span> <span class="kn">import</span> <span class="n">TauArch</span>


<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">SOURCES</span> <span class="o">=</span> <span class="p">{</span><span class="bp">None</span><span class="p">:</span> <span class="s">&#39;http://tau.uoregon.edu/tau.tgz&#39;</span><span class="p">}</span>

<span class="n">COMMANDS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;jumpshot&#39;</span><span class="p">,</span>
    <span class="s">&#39;paraprof&#39;</span><span class="p">,</span>
    <span class="s">&#39;perfdmf_configure&#39;</span><span class="p">,</span>
    <span class="s">&#39;perfdmf_createapp&#39;</span><span class="p">,</span>
    <span class="s">&#39;perfdmf_createexp&#39;</span><span class="p">,</span>
    <span class="s">&#39;perfdmfdb.py&#39;</span><span class="p">,</span>
    <span class="s">&#39;perfdmf_loadtrial&#39;</span><span class="p">,</span>
    <span class="s">&#39;perfexplorer&#39;</span><span class="p">,</span>
    <span class="s">&#39;perfexplorer_configure&#39;</span><span class="p">,</span>
    <span class="s">&#39;phaseconvert&#39;</span><span class="p">,</span>
    <span class="s">&#39;pprof&#39;</span><span class="p">,</span>
    <span class="s">&#39;ppscript&#39;</span><span class="p">,</span>
    <span class="s">&#39;slog2print&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau2slog2&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_analyze&#39;</span><span class="p">,</span>
    <span class="s">&#39;taucc&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_cc.sh&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_compiler.sh&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau-config&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_convert&#39;</span><span class="p">,</span>
    <span class="s">&#39;taucxx&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_cxx.sh&#39;</span><span class="p">,</span>
    <span class="s">&#39;taudb_configure&#39;</span><span class="p">,</span>
    <span class="s">&#39;taudb_install_cert&#39;</span><span class="p">,</span>
    <span class="s">&#39;taudb_keygen&#39;</span><span class="p">,</span>
    <span class="s">&#39;taudb_loadtrial&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_ebs2otf.pl&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_ebs_process.pl&#39;</span><span class="p">,</span>
    <span class="s">&#39;tauex&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_exec&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_f77.sh&#39;</span><span class="p">,</span>
    <span class="s">&#39;tauf90&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_f90.sh&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_gen_wrapper&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_header_replace.pl&#39;</span><span class="p">,</span>
    <span class="s">&#39;tauinc.pl&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_java&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_javamax.sh&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_macro.sh&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_merge&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_multimerge&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_pebil_rewrite&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_reduce&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_rewrite&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_selectfile&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_show_libs&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_throttle.sh&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_treemerge.pl&#39;</span><span class="p">,</span>
    <span class="s">&#39;tauupc&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_upc.sh&#39;</span><span class="p">,</span>
    <span class="s">&#39;tau_user_setup.sh&#39;</span><span class="p">,</span>
    <span class="s">&#39;trace2profile&#39;</span><span class="p">]</span>


<span class="n">TAU_COMPILER_WRAPPERS</span> <span class="o">=</span> <span class="p">{</span><span class="n">CC_ROLE</span><span class="p">:</span> <span class="s">&#39;tau_cc.sh&#39;</span><span class="p">,</span>
                         <span class="n">CXX_ROLE</span><span class="p">:</span> <span class="s">&#39;tau_cxx.sh&#39;</span><span class="p">,</span>
                         <span class="n">FC_ROLE</span><span class="p">:</span> <span class="s">&#39;tau_f90.sh&#39;</span><span class="p">,</span>
                         <span class="n">UPC_ROLE</span><span class="p">:</span> <span class="s">&#39;tau_upc.sh&#39;</span><span class="p">,</span>
                         <span class="n">MPI_CC_ROLE</span><span class="p">:</span> <span class="s">&#39;tau_cc.sh&#39;</span><span class="p">,</span>
                         <span class="n">MPI_CXX_ROLE</span><span class="p">:</span> <span class="s">&#39;tau_cxx.sh&#39;</span><span class="p">,</span>
                         <span class="n">MPI_FC_ROLE</span><span class="p">:</span> <span class="s">&#39;tau_f90.sh&#39;</span><span class="p">}</span>


<div class="viewcode-block" id="TauInstallation"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation">[docs]</a><span class="k">class</span> <span class="nc">TauInstallation</span><span class="p">(</span><span class="n">Installation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encapsulates a TAU installation.</span>
<span class="sd">    </span>
<span class="sd">    TAU is an enormous, organic, complex piece of software so this class is </span>
<span class="sd">    unusually complex to consider all the corner cases.  This is where most</span>
<span class="sd">    of the systemization of TAU is actually implemented so it can get ugly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">host_arch</span><span class="p">,</span> <span class="n">host_os</span><span class="p">,</span> <span class="n">compilers</span><span class="p">,</span> 
                 <span class="n">verbose</span><span class="p">,</span>
                 <span class="c"># Source for dependencies</span>
                 <span class="n">pdt_source</span><span class="p">,</span>
                 <span class="n">binutils_source</span><span class="p">,</span>
                 <span class="n">libunwind_source</span><span class="p">,</span>
                 <span class="n">papi_source</span><span class="p">,</span>
                 <span class="c"># Application support features</span>
                 <span class="n">openmp_support</span><span class="p">,</span>
                 <span class="n">pthreads_support</span><span class="p">,</span> 
                 <span class="n">mpi_support</span><span class="p">,</span>
                 <span class="n">mpi_include_path</span><span class="p">,</span>
                 <span class="n">mpi_library_path</span><span class="p">,</span>
                 <span class="n">mpi_libraries</span><span class="p">,</span>
                 <span class="n">cuda_support</span><span class="p">,</span>
                 <span class="n">shmem_support</span><span class="p">,</span>
                 <span class="n">mpc_support</span><span class="p">,</span>
                 <span class="c"># Instrumentation methods and options</span>
                 <span class="n">source_inst</span><span class="p">,</span>
                 <span class="n">compiler_inst</span><span class="p">,</span>
                 <span class="n">link_only</span><span class="p">,</span>
                 <span class="n">io_inst</span><span class="p">,</span>
                 <span class="n">keep_inst_files</span><span class="p">,</span>
                 <span class="n">reuse_inst_files</span><span class="p">,</span>
                 <span class="c"># Measurement methods and options</span>
                 <span class="n">profile</span><span class="p">,</span>
                 <span class="n">trace</span><span class="p">,</span>
                 <span class="n">sample</span><span class="p">,</span>
                 <span class="n">metrics</span><span class="p">,</span>
                 <span class="n">measure_mpi</span><span class="p">,</span>
                 <span class="n">measure_openmp</span><span class="p">,</span>
                 <span class="n">measure_pthreads</span><span class="p">,</span>
                 <span class="n">measure_cuda</span><span class="p">,</span>
                 <span class="n">measure_shmem</span><span class="p">,</span>
                 <span class="n">measure_mpc</span><span class="p">,</span>
                 <span class="n">measure_memory_usage</span><span class="p">,</span>
                 <span class="n">measure_memory_alloc</span><span class="p">,</span>
                 <span class="n">callpath_depth</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the TAU installation wrapper class.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            prefix (str): Path to a directory to contain subdirectories for </span>
<span class="sd">                          installation files, source file, and compilation files.</span>
<span class="sd">            src (str): Path to a directory where the software has already been </span>
<span class="sd">                       installed, or a path to a source archive file, or the special</span>
<span class="sd">                       keyword &#39;download&#39;.</span>
<span class="sd">            host_arch (Architecture): Target architecture description.</span>
<span class="sd">            host_os (OperatingSystem): Target operating system description.</span>
<span class="sd">            compilers (InstalledCompilerSet): Compilers to use if software must be compiled.</span>
<span class="sd">            verbose (bool): True to enable TAU verbose output.</span>
<span class="sd">            pdt_source (str): Path to PDT source, installation, or None.</span>
<span class="sd">            binutils_source (str): Path to GNU binutils source, installation, or None.</span>
<span class="sd">            libunwind_source (str): Path to libunwind source, installation, or None.</span>
<span class="sd">            papi_source (str): Path to PAPI source, installation, or None.</span>
<span class="sd">            openmp_support (bool): Enable or disable OpenMP support in TAU.</span>
<span class="sd">            pthreads_support (bool): Enable or disable pthreads support in TAU.</span>
<span class="sd">            mpi_support (bool): Enable or disable MPI support in TAU.</span>
<span class="sd">            mpi_include_path (list):  Paths to search for MPI header files. </span>
<span class="sd">            mpi_library_path (list): Paths to search for MPI library files.</span>
<span class="sd">            mpi_libraries (list): MPI libraries to include when linking with TAU.</span>
<span class="sd">            cuda_support (bool): Enable or disable CUDA support in TAU.</span>
<span class="sd">            shmem_support (bool): Enable or disable SHMEM support in TAU.</span>
<span class="sd">            mpc_support (bool): Enable or disable MPC support in TAU.</span>
<span class="sd">            source_inst (bool): Enable or disable source-based instrumentation in TAU.</span>
<span class="sd">            compiler_inst (bool): Enable or disable compiler-based instrumentation in TAU. </span>
<span class="sd">            link_only (bool): True to disable instrumentation and link TAU libraries.</span>
<span class="sd">            io_inst (bool): Enable or disable POSIX I/O instrumentation in TAU.</span>
<span class="sd">            keep_inst_files (bool): If True then do not remove instrumented source files after compilation.</span>
<span class="sd">            reuse_inst_files (bool): If True then reuse instrumented source files for compilation when available.</span>
<span class="sd">            profile (bool): Enable or disable profiling.</span>
<span class="sd">            trace (bool): Enable or disable tracing.</span>
<span class="sd">            sample (bool): Enable or disable event-based sampling.</span>
<span class="sd">            metrics (list): Metrics to measure, e.g. [&#39;TIME&#39;, &#39;PAPI_FP_INS&#39;]</span>
<span class="sd">            measure_mpi (bool): If True then measure time spent in MPI calls. </span>
<span class="sd">            measure_openmp (bool): If True then measure time spent in OpenMP directives.</span>
<span class="sd">            measure_pthreads (bool): If True then measure time spent in pthread calls.</span>
<span class="sd">            measure_cuda (bool): If True then measure time spent in CUDA calls.</span>
<span class="sd">            measure_shmem (bool): If True then measure time spent in SHMEM calls.</span>
<span class="sd">            measure_mpc (bool): If True then measure time spent in MPC calls.</span>
<span class="sd">            measure_memory_usage (bool): If True then measure memory usage.</span>
<span class="sd">            measure_memory_alloc (bool): If True then record memory allocation **and deallocation** events.</span>
<span class="sd">            callpath_depth (int): Depth of callpath measurement.  0 to disable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdt</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binutils</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">libunwind</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">papi</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">arch</span> <span class="o">=</span> <span class="n">TauArch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">host_arch</span><span class="p">,</span> <span class="n">host_os</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="s">&quot;Invalid host_arch &#39;</span><span class="si">%s</span><span class="s">&#39; or host_os &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">host_arch</span><span class="p">,</span> <span class="n">host_os</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TauInstallation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="s">&#39;TAU&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">arch</span><span class="p">,</span> <span class="n">compilers</span><span class="p">,</span> <span class="n">SOURCES</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arch_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">arch</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arch_path</span><span class="p">,</span> <span class="s">&#39;bin&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arch_path</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdt_source</span> <span class="o">=</span> <span class="n">pdt_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binutils_source</span> <span class="o">=</span> <span class="n">binutils_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">libunwind_source</span> <span class="o">=</span> <span class="n">libunwind_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">papi_source</span> <span class="o">=</span> <span class="n">papi_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openmp_support</span> <span class="o">=</span> <span class="n">openmp_support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pthreads_support</span> <span class="o">=</span> <span class="n">pthreads_support</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span> <span class="o">=</span> <span class="n">mpi_support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpi_include_path</span> <span class="o">=</span> <span class="n">mpi_include_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpi_library_path</span> <span class="o">=</span> <span class="n">mpi_library_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpi_libraries</span> <span class="o">=</span> <span class="n">mpi_libraries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cuda_support</span> <span class="o">=</span> <span class="n">cuda_support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shmem_support</span> <span class="o">=</span> <span class="n">shmem_support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpc_support</span> <span class="o">=</span> <span class="n">mpc_support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_inst</span> <span class="o">=</span> <span class="n">source_inst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">=</span> <span class="n">compiler_inst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_only</span> <span class="o">=</span> <span class="n">link_only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">io_inst</span> <span class="o">=</span> <span class="n">io_inst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_inst_files</span> <span class="o">=</span> <span class="n">keep_inst_files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reuse_inst_files</span> <span class="o">=</span> <span class="n">reuse_inst_files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">profile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_mpi</span> <span class="o">=</span> <span class="n">measure_mpi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span> <span class="o">=</span> <span class="n">measure_openmp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_pthreads</span> <span class="o">=</span> <span class="n">measure_pthreads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_cuda</span> <span class="o">=</span> <span class="n">measure_cuda</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_shmem</span> <span class="o">=</span> <span class="n">measure_shmem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_mpc</span> <span class="o">=</span> <span class="n">measure_mpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_memory_usage</span> <span class="o">=</span> <span class="n">measure_memory_usage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_memory_alloc</span> <span class="o">=</span> <span class="n">measure_memory_alloc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callpath_depth</span> <span class="o">=</span> <span class="n">callpath_depth</span>
        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;pdt&#39;</span><span class="p">,</span> <span class="s">&#39;binutils&#39;</span><span class="p">,</span> <span class="s">&#39;libunwind&#39;</span><span class="p">,</span> <span class="s">&#39;papi&#39;</span><span class="p">]:</span>
            <span class="c"># We save a lot of typing here by using eval.</span>
            <span class="c"># pylint: disable=eval-used</span>
            <span class="k">if</span> <span class="nb">eval</span><span class="p">(</span><span class="s">&#39;self.uses_</span><span class="si">%s</span><span class="s">()&#39;</span> <span class="o">%</span> <span class="n">pkg</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_source&#39;</span> <span class="o">%</span> <span class="n">pkg</span><span class="p">):</span> 
                    <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s">&quot;Specified TAU configuration requires </span><span class="si">%s</span><span class="s"> but no source specified&quot;</span> <span class="o">%</span> <span class="n">pkg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pkg</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        
<div class="viewcode-block" id="TauInstallation.uses_pdt"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.uses_pdt">[docs]</a>    <span class="k">def</span> <span class="nf">uses_pdt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_inst</span> <span class="o">!=</span> <span class="s">&#39;never&#39;</span>
    </div>
<div class="viewcode-block" id="TauInstallation.uses_binutils"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.uses_binutils">[docs]</a>    <span class="k">def</span> <span class="nf">uses_binutils</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">or</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">!=</span> <span class="s">&#39;never&#39;</span> <span class="ow">or</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span> <span class="o">==</span> <span class="s">&#39;ompt&#39;</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span> <span class="o">==</span> <span class="s">&#39;gomp&#39;</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="TauInstallation.uses_libunwind"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.uses_libunwind">[docs]</a>    <span class="k">def</span> <span class="nf">uses_libunwind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arch</span> <span class="o">!=</span> <span class="s">&#39;apple&#39;</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">or</span> 
                 <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">!=</span> <span class="s">&#39;never&#39;</span> <span class="ow">or</span> 
                 <span class="bp">self</span><span class="o">.</span><span class="n">openmp_support</span><span class="p">))</span>
        </div>
<div class="viewcode-block" id="TauInstallation.uses_papi"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.uses_papi">[docs]</a>    <span class="k">def</span> <span class="nf">uses_papi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">met</span> <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="k">if</span> <span class="s">&#39;PAPI&#39;</span> <span class="ow">in</span> <span class="n">met</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="TauInstallation._check_dependencies"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation._check_dependencies">[docs]</a>    <span class="k">def</span> <span class="nf">_check_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensures all required dependencies are installed and working.</span>
<span class="sd">        </span>
<span class="sd">        Kicks off dependency installation if a required dependency is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uses_pdt</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdt</span> <span class="o">=</span> <span class="n">PdtInstallation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdt_source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdt</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pdt</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uses_binutils</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binutils</span> <span class="o">=</span> <span class="n">BinutilsInstallation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binutils_source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">binutils</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binutils</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uses_libunwind</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">libunwind</span> <span class="o">=</span> <span class="n">LibunwindInstallation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">libunwind_source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">libunwind</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">libunwind</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uses_papi</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">papi</span> <span class="o">=</span> <span class="n">PapiInstallation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">papi_source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">papi</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">papi</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="TauInstallation._verify"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation._verify">[docs]</a>    <span class="k">def</span> <span class="nf">_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commands</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">libraries</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns true if the installation is valid.</span>
<span class="sd">        </span>
<span class="sd">        A working TAU installation has a directory named `arch` </span>
<span class="sd">        containing `bin` and `lib` directories and provides all expected</span>
<span class="sd">        libraries and commands.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            True: If the installation at `install_prefix` is working.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">          SoftwarePackageError: Describes why the installation is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TauInstallation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_verify</span><span class="p">(</span><span class="n">commands</span><span class="o">=</span><span class="n">COMMANDS</span><span class="p">)</span>

        <span class="c"># Open TAU makefile and check BFDINCLUDE, UNWIND_INC, PAPIDIR, etc.</span>
        <span class="n">makefile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_makefile</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">makefile</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binutils</span> <span class="ow">and</span> <span class="p">(</span><span class="s">&#39;BFDINCLUDE=&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span>
                    <span class="n">bfd_inc</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&quot;-I&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binutils</span><span class="o">.</span><span class="n">include_path</span> <span class="o">!=</span> <span class="n">bfd_inc</span><span class="p">:</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;BFDINCLUDE=&#39;</span><span class="si">%s</span><span class="s">&#39; != &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="p">,</span> <span class="n">bfd_inc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binutils</span><span class="o">.</span><span class="n">include_path</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s">&quot;BFDINCLUDE in TAU Makefile &quot;</span>
                                                   <span class="s">&quot;doesn&#39;t match target BFD installation&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">libunwind</span> <span class="ow">and</span> <span class="p">(</span><span class="s">&#39;UNWIND_INC=&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span>
                    <span class="n">libunwind_inc</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&quot;-I&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">libunwind</span><span class="o">.</span><span class="n">include_path</span> <span class="o">!=</span> <span class="n">libunwind_inc</span><span class="p">:</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;UNWIND_INC=&#39;</span><span class="si">%s</span><span class="s">&#39; != &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="p">,</span> <span class="n">libunwind_inc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">libunwind</span><span class="o">.</span><span class="n">include_path</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s">&quot;UNWIND_INC in TAU Makefile &quot;</span>
                                                   <span class="s">&quot;doesn&#39;t match target libunwind installation&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">papi</span> <span class="ow">and</span> <span class="p">(</span><span class="s">&#39;PAPIDIR=&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span>
                    <span class="n">papi_dir</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">papi</span><span class="o">.</span><span class="n">install_prefix</span> <span class="o">!=</span> <span class="n">papi_dir</span><span class="p">:</span>
                        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;PAPI_DIR=&#39;</span><span class="si">%s</span><span class="s">&#39; != &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="p">,</span> <span class="n">papi_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">papi</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s">&quot;PAPI_DIR in TAU Makefile &quot;</span>
                                                   <span class="s">&quot;doesn&#39;t match target PAPI installation&quot;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;TAU installation at &#39;</span><span class="si">%s</span><span class="s">&#39; is valid&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    </div>
<div class="viewcode-block" id="TauInstallation.configure"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configures TAU</span>
<span class="sd">        </span>
<span class="sd">        Executes TAU&#39;s configuration script with appropriate arguments to support the specified configuration.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            SoftwareConfigurationError: TAU&#39;s configure script failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># TAU&#39;s configure script does a really bad job of detecting MPI settings</span>
        <span class="c"># so set up mpiinc, mpilib, mpilibrary when we have that information</span>
        <span class="n">mpiinc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">mpilib</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">mpilibrary</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span><span class="p">:</span> 
            <span class="c"># TAU&#39;s configure script does a really bad job detecting the wrapped compiler command</span>
            <span class="c"># so don&#39;t even bother trying.  Pass as much of this as we can and hope for the best.</span>
            <span class="n">cc_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">MPI_CC_ROLE</span><span class="p">]</span><span class="o">.</span><span class="n">wrapped</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">command</span>
            <span class="n">cxx_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">MPI_CXX_ROLE</span><span class="p">]</span><span class="o">.</span><span class="n">wrapped</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">command</span>
            <span class="n">fc_family</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">MPI_FC_ROLE</span><span class="p">]</span><span class="o">.</span><span class="n">wrapped</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">family</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_include_path</span><span class="p">:</span>
                <span class="c"># Unfortunately, TAU&#39;s configure script can only accept one path on -mpiinc</span>
                <span class="c"># and it expects the compiler&#39;s include path argument (e.g. &quot;-I&quot;) to be omitted</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_include_path</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;mpi.h&#39;</span><span class="p">)):</span>
                        <span class="n">mpiinc</span> <span class="o">=</span> <span class="n">path</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mpiinc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s">&quot;mpi.h not found on MPI include path: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_include_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_library_path</span><span class="p">:</span>
                <span class="c"># Unfortunately, TAU&#39;s configure script can only accept one path on -mpilib</span>
                <span class="c"># and it expects the compiler&#39;s include path argument (e.g. &quot;-L&quot;) to be omitted</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_library_path</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;libmpi*&#39;</span><span class="p">)):</span>
                        <span class="n">mpilib</span> <span class="o">=</span> <span class="n">path</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_libraries</span><span class="p">:</span>
                <span class="c"># Multiple MPI libraries can be given but only if they&#39;re separated by a &#39;#&#39; symbol</span>
                <span class="c"># and the compiler&#39;s library linking flag (e.g. &#39;-l&#39;) must be included</span>
                <span class="n">link_library_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CC_ROLE</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">family</span><span class="o">.</span><span class="n">link_library_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">mpilibrary</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;</span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">link_library_flag</span><span class="p">,</span> <span class="n">library</span><span class="p">)</span> <span class="k">for</span> <span class="n">library</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_libraries</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># TAU&#39;s configure script can&#39;t cope with compiler absolute paths or compiler names that</span>
            <span class="c"># don&#39;t exactly match what it expects.  Use `info.command` instead of `command` to work</span>
            <span class="c"># around these problems e.g. &#39;gcc-4.9&#39; becomes &#39;gcc&#39; </span>
            <span class="n">cc_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CC_ROLE</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">command</span>
            <span class="n">cxx_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CXX_ROLE</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">command</span>
            <span class="n">fc_family</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">FC_ROLE</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">family</span>

        <span class="c"># TAU&#39;s configure script can&#39;t detect Fortran compiler from the compiler</span>
        <span class="c"># command so translate Fortran compiler command into TAU&#39;s funkey magic words</span>
        <span class="n">magic_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">GNU_COMPILERS</span><span class="p">:</span> <span class="s">&#39;gfortran&#39;</span><span class="p">,</span>
                     <span class="n">INTEL_COMPILERS</span><span class="p">:</span> <span class="s">&#39;intel&#39;</span><span class="p">,</span>
                     <span class="n">PGI_COMPILERS</span><span class="p">:</span> <span class="s">&#39;pgi&#39;</span><span class="p">,</span>
                     <span class="n">SYSTEM_COMPILERS</span><span class="p">:</span> <span class="s">&#39;ftn&#39;</span><span class="p">,</span>
                     <span class="n">SYSTEM_MPI_COMPILERS</span><span class="p">:</span> <span class="s">&#39;mpif90&#39;</span><span class="p">,</span>
                     <span class="n">INTEL_MPI_COMPILERS</span><span class="p">:</span> <span class="s">&#39;mpiifort&#39;</span><span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fortran_magic</span> <span class="o">=</span> <span class="n">magic_map</span><span class="p">[</span><span class="n">fc_family</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="s">&quot;Unknown compiler family for Fortran: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">fc_family</span><span class="p">)</span>
        
        <span class="n">pdt_cxx_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdt</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CXX_ROLE</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">command</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdt</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
            
        <span class="n">flags</span> <span class="o">=</span> <span class="p">[</span> <span class="n">flag</span> <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span>  
                 <span class="p">[</span><span class="s">&#39;-prefix=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">,</span>
                  <span class="s">&#39;-arch=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span>
                  <span class="s">&#39;-cc=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">cc_command</span><span class="p">,</span>
                  <span class="s">&#39;-c++=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">cxx_command</span><span class="p">,</span>
                  <span class="s">&#39;-pdt_c++=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">pdt_cxx_command</span><span class="p">,</span>
                  <span class="s">&#39;-fortran=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fortran_magic</span><span class="p">,</span>
                  <span class="s">&#39;-pdt=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdt</span><span class="o">.</span><span class="n">install_prefix</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdt</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;-bfd=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">binutils</span><span class="o">.</span><span class="n">install_prefix</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binutils</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;-papi=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">papi</span><span class="o">.</span><span class="n">install_prefix</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">papi</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;-unwind=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">libunwind</span><span class="o">.</span><span class="n">install_prefix</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">libunwind</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;-pthread&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pthreads_support</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;-mpi&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;-mpiinc=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mpiinc</span> <span class="k">if</span> <span class="n">mpiinc</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;-mpilib=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mpilib</span> <span class="k">if</span> <span class="n">mpilib</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                  <span class="s">&#39;-mpilibrary=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mpilibrary</span> <span class="k">if</span> <span class="n">mpilibrary</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
                  <span class="p">]</span> <span class="k">if</span> <span class="n">flag</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">openmp_support</span><span class="p">:</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-openmp&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span> <span class="o">==</span> <span class="s">&#39;ompt&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CC_ROLE</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">family</span> <span class="o">==</span> <span class="n">INTEL_COMPILERS</span><span class="p">:</span>
                    <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-ompt&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># TODO: Shouldn&#39;t this be checked in model `compatible_with`?</span>
                    <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s">&#39;OMPT for OpenMP measurement only works with Intel compilers&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span> <span class="o">==</span> <span class="s">&#39;opari&#39;</span><span class="p">:</span>
                <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-opari&#39;</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;./configure&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">flags</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Configuring TAU...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">src_prefix</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s">&#39;TAU configure failed&#39;</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="TauInstallation.make_install"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.make_install">[docs]</a>    <span class="k">def</span> <span class="nf">make_install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Installs TAU to ``self.install_prefix``.</span>
<span class="sd">        </span>
<span class="sd">        Executes &#39;make install&#39; to build and install TAU.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            SoftwarePackageError: &#39;make install&#39; failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;make&#39;</span><span class="p">,</span> <span class="s">&#39;install&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">parallel_make_flags</span><span class="p">()</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Compiling and installing TAU...&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">src_prefix</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s">&#39;TAU compilation/installation failed&#39;</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="TauInstallation.install"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.install">[docs]</a>    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_reinstall</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Installs TAU.</span>
<span class="sd">        </span>
<span class="sd">        Configures, compiles, and installs TAU with all necessarry makefiles and libraries.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            force_reinstall (bool): Set to True to force reinstall even if TAU is already installed and working.</span>
<span class="sd">            </span>
<span class="sd">        Raises:</span>
<span class="sd">            SoftwarePackageError: TAU failed installation or did not pass verification after it was installed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_dependencies</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">SoftwarePackageError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> installation at &#39;</span><span class="si">%s</span><span class="s">&#39; is missing or broken: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> 
                                           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">,</span> <span class="n">err</span><span class="p">),</span>
                                           <span class="s">&quot;Specify source code path or URL to enable broken package reinstallation.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">force_reinstall</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">SoftwarePackageError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Installing </span><span class="si">%s</span><span class="s"> at &#39;</span><span class="si">%s</span><span class="s">&#39; from &#39;</span><span class="si">%s</span><span class="s">&#39; with arch=</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s"> compilers&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CC_ROLE</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">family</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_src</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_install</span><span class="p">()</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> installation complete&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TauInstallation.get_makefile_tags"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.get_makefile_tags">[docs]</a>    <span class="k">def</span> <span class="nf">get_makefile_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get makefile tags for this TAU installation.</span>

<span class="sd">        Each TAU Makefile is identified by its tags.  Tags are also used by</span>
<span class="sd">        tau_exec to load the correct version of the TAU shared object library.</span>

<span class="sd">        Tags can appear in the makefile name in any order so the order of the</span>
<span class="sd">        tags returned by this function will likely not match the order they</span>
<span class="sd">        appear in the makefile name or tau_exec command line.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Makefile tags, e.g. [&#39;papi&#39;, &#39;pdt&#39;, &#39;icpc&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">compiler_tags</span> <span class="o">=</span> <span class="p">{</span><span class="n">INTEL_COMPILERS</span><span class="p">:</span> <span class="s">&#39;icpc&#39;</span><span class="p">,</span> 
                         <span class="n">PGI_COMPILERS</span><span class="p">:</span> <span class="s">&#39;pgi&#39;</span><span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compiler_tags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">[</span><span class="n">CXX_ROLE</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">family</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_inst</span> <span class="o">!=</span> <span class="s">&#39;never&#39;</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;pdt&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">met</span> <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="k">if</span> <span class="s">&#39;PAPI&#39;</span> <span class="ow">in</span> <span class="n">met</span><span class="p">]):</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;papi&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">openmp_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;openmp&#39;</span><span class="p">)</span>
            <span class="n">openmp_tags</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;ompt&#39;</span><span class="p">:</span> <span class="s">&#39;ompt&#39;</span><span class="p">,</span> <span class="s">&#39;opari&#39;</span><span class="p">:</span> <span class="s">&#39;opari&#39;</span><span class="p">}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">openmp_tags</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pthreads_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;pthread&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;mpi&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuda_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;cuda&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shmem_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;shmem&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpc_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;mpc&#39;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;TAU tags: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="TauInstallation._incompatible_tags"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation._incompatible_tags">[docs]</a>    <span class="k">def</span> <span class="nf">_incompatible_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a set of makefile tags incompatible with the specified config.</span>
<span class="sd">        </span>
<span class="sd">        Some tags, e.g. PDT, force actions to occur that should not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;mpi&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_inst</span> <span class="o">==</span> <span class="s">&#39;never&#39;</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;pdt&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_openmp</span> <span class="o">!=</span> <span class="s">&#39;opari&#39;</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;opari&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openmp_support</span><span class="p">:</span>
            <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;openmp&#39;</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Incompatible tags: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TauInstallation.get_makefile"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.get_makefile">[docs]</a>    <span class="k">def</span> <span class="nf">get_makefile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an absolute path to a TAU_MAKEFILE.</span>

<span class="sd">        The file returned *should* supply all requested measurement features </span>
<span class="sd">        and application support features specified in the constructor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A file path that could be used to set the TAU_MAKEFILE environment</span>
<span class="sd">                 variable, or None if a suitable makefile couldn&#39;t be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau_makefiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_path</span><span class="p">,</span> <span class="s">&#39;Makefile.tau*&#39;</span><span class="p">))</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Found makefiles: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="p">,</span> <span class="n">tau_makefiles</span><span class="p">)</span>
        <span class="n">config_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_makefile_tags</span><span class="p">()</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Searching for makefile with tags: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">config_tags</span><span class="p">)</span>
        <span class="n">approx_tags</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">approx_makefile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">dangerous_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_incompatible_tags</span><span class="p">()</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Will not use makefiles containing tags: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dangerous_tags</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">makefile</span> <span class="ow">in</span> <span class="n">tau_makefiles</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">makefile</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> has tags: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">makefile</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">config_tags</span> <span class="o">&lt;=</span> <span class="n">tags</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> contains desired tags: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">makefile</span><span class="p">,</span> <span class="n">config_tags</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tags</span> <span class="o">&lt;=</span> <span class="n">config_tags</span><span class="p">:</span>
                    <span class="n">makefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_path</span><span class="p">,</span> <span class="n">makefile</span><span class="p">)</span> 
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Found TAU makefile </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">makefile</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">makefile</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">tags</span> <span class="o">&amp;</span> <span class="n">dangerous_tags</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">approx_tags</span> <span class="ow">or</span> <span class="n">tags</span> <span class="o">&lt;</span> <span class="n">approx_tags</span><span class="p">:</span>
                        <span class="n">approx_makefile</span> <span class="o">=</span> <span class="n">makefile</span>
                        <span class="n">approx_tags</span> <span class="o">=</span> <span class="n">tags</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Best approximate match is: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">approx_tags</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;No TAU makefile exactly matches tags &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="p">,</span> <span class="n">config_tags</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">approx_makefile</span><span class="p">:</span>
            <span class="n">makefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib_path</span><span class="p">,</span> <span class="n">approx_makefile</span><span class="p">)</span> 
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Found approximate match with TAU makefile </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">makefile</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">makefile</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;No TAU makefile approximately matches tags &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="p">,</span> <span class="n">config_tags</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SoftwarePackageError</span><span class="p">(</span><span class="s">&quot;TAU Makefile not found for tags &#39;</span><span class="si">%s</span><span class="s">&#39; in &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> 
                                   <span class="p">(</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_tags</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">install_prefix</span><span class="p">))</span>
</div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_sanitize_environment</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unsets any TAU environment variables that were set by the user.</span>
<span class="sd">        </span>
<span class="sd">        A user&#39;s preexisting TAU configuration may conflict with the configuration</span>
<span class="sd">        specified by the TAU Commander project.  This routine lets us work in a</span>
<span class="sd">        clean environment without disrupting the user&#39;s shell environment.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            env (dict): Environment variables.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: `env` without TAU environment variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_tau_var</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">key</span><span class="p">:</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;TAU_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;PROFILEDIR&#39;</span><span class="p">,</span> <span class="s">&#39;TRACEDIR&#39;</span><span class="p">]</span>
        <span class="n">dirt</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">is_tau_var</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
        <span class="k">if</span> <span class="n">dirt</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Ignoring preexisting TAU environment variables:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dirt</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()]))</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dirt</span><span class="p">])</span>
    
<div class="viewcode-block" id="TauInstallation.compiletime_config"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.compiletime_config">[docs]</a>    <span class="k">def</span> <span class="nf">compiletime_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configures environment for compilation with TAU.</span>

<span class="sd">        Modifies incoming command line arguments and environment variables</span>
<span class="sd">        for the TAU compiler wrapper scripts.</span>

<span class="sd">        Args:</span>
<span class="sd">            opts (list): Command line options.</span>
<span class="sd">            env (dict): Environment variables.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple: (opts, env) updated to support TAU.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TauInstallation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">compiletime_config</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_environment</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdt</span><span class="p">:</span>
            <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdt</span><span class="o">.</span><span class="n">compiletime_config</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binutils</span><span class="p">:</span>
            <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binutils</span><span class="o">.</span><span class="n">compiletime_config</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">papi</span><span class="p">:</span>
            <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">papi</span><span class="o">.</span><span class="n">compiletime_config</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">libunwind</span><span class="p">:</span>
            <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">libunwind</span><span class="o">.</span><span class="n">compiletime_config</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tau_opts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s">&#39;TAU_OPTIONS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">tau_opts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;-optRevert&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;-optVerbose&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">==</span> <span class="s">&#39;always&#39;</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;-optCompInst&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">==</span> <span class="s">&#39;never&#39;</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;-optNoCompInst&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">==</span> <span class="s">&#39;fallback&#39;</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;-optRevert&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_only</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;-optLinkOnly&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_inst_files</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;-optKeepFiles&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reuse_inst_files</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;-optReuseFiles&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">io_inst</span><span class="p">:</span>
            <span class="n">tau_opts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;-optTrackIO&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">!=</span> <span class="s">&#39;never&#39;</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-g&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;TAU_MAKEFILE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_makefile</span><span class="p">()</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;TAU_OPTIONS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tau_opts</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">opts</span><span class="p">)),</span> <span class="n">env</span>

</div>
<div class="viewcode-block" id="TauInstallation.runtime_config"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.runtime_config">[docs]</a>    <span class="k">def</span> <span class="nf">runtime_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configures environment for execution with TAU.</span>
<span class="sd">        </span>
<span class="sd">        Modifies incoming command line arguments and environment variables </span>
<span class="sd">        for the TAU library and tau_exec script.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            opts (list): Command line options.</span>
<span class="sd">            env (dict): Environment variables.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple: (opts, env) updated to support TAU.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TauInstallation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">runtime_config</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_environment</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;TAU_VERBOSE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">))</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;TAU_PROFILE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">))</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;TAU_TRACE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">))</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;TAU_SAMPLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callpath_depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s">&#39;TAU_CALLPATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;1&#39;</span>
            <span class="n">env</span><span class="p">[</span><span class="s">&#39;TAU_CALLPATH_DEPTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callpath_depth</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-v&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-ebs&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;TAU_METRICS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">opts</span><span class="p">)),</span> <span class="n">env</span>
</div>
<div class="viewcode-block" id="TauInstallation.get_compiler_command"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.get_compiler_command">[docs]</a>    <span class="k">def</span> <span class="nf">get_compiler_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compiler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the compiler wrapper command for the given compiler.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            compiler (InstalledCompiler): A compiler to find a wrapper for.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            str: Command for TAU compiler wrapper without path or arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">use_wrapper</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_inst</span> <span class="o">!=</span> <span class="s">&#39;never&#39;</span> <span class="ow">or</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">!=</span> <span class="s">&#39;never&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_wrapper</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TAU_COMPILER_WRAPPERS</span><span class="p">[</span><span class="n">compiler</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">role</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">compiler</span><span class="o">.</span><span class="n">absolute_path</span>
</div>
<div class="viewcode-block" id="TauInstallation.compile"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.compile">[docs]</a>    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">compiler_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Executes a compilation command.</span>
<span class="sd">        </span>
<span class="sd">        Sets TAU environment variables and configures TAU compiler wrapper</span>
<span class="sd">        command line arguments to match specified configuration, then</span>
<span class="sd">        executes the compiler command. </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            compiler (Compiler): A compiler command.</span>
<span class="sd">            compiler_args (list): Compiler command line arguments.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ConfigurationError: Compilation failed.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            int: Compiler return value (always 0 if no exception raised). </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiletime_config</span><span class="p">()</span>
        <span class="n">compiler_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compiler_command</span><span class="p">(</span><span class="n">compiler</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">compiler_cmd</span><span class="p">]</span> <span class="o">+</span> <span class="n">opts</span> <span class="o">+</span> <span class="n">compiler_args</span>
        <span class="n">tau_env_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;TAU_&#39;</span><span class="p">)]</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tau_env_opts</span><span class="p">))</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s">&quot;TAU was unable to build the application.&quot;</span><span class="p">,</span>
                                     <span class="s">&quot;See detailed output at the end of in &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">logger</span><span class="o">.</span><span class="n">LOG_FILE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span>
</div>
<div class="viewcode-block" id="TauInstallation.get_application_command"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.get_application_command">[docs]</a>    <span class="k">def</span> <span class="nf">get_application_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">application_cmd</span><span class="p">,</span> <span class="n">application_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build a command line to launch an application under TAU.</span>
<span class="sd">        </span>
<span class="sd">        Sometimes TAU needs to use tau_exec, sometimes not.  This routine</span>
<span class="sd">        also handles backend launch commands like `aprun`.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            application_cmd (str): The application command, e.g. &#39;./a.out&#39;.</span>
<span class="sd">            application_args (list): The application command line arguments.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple: (cmd, env) where `cmd` is the new command line and `env` is</span>
<span class="sd">                   a dictionary of environment variables to set before running</span>
<span class="sd">                   the application command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau_exec_opts</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_config</span><span class="p">()</span>
        <span class="n">use_tau_exec</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_inst</span> <span class="o">==</span> <span class="s">&#39;never&#39;</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">compiler_inst</span> <span class="o">==</span> <span class="s">&#39;never&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_tau_exec</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_makefile_tags</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpi_support</span><span class="p">:</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;serial&#39;</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;tau_exec&#39;</span><span class="p">,</span> <span class="s">&#39;-T&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tags</span><span class="p">)]</span> <span class="o">+</span> <span class="n">tau_exec_opts</span> <span class="o">+</span> <span class="p">[</span><span class="n">application_cmd</span><span class="p">]</span> <span class="o">+</span> <span class="n">application_args</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">application_cmd</span><span class="p">]</span> <span class="o">+</span> <span class="n">application_args</span>
        <span class="k">return</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">env</span>

</div>
<div class="viewcode-block" id="TauInstallation.show_profile"><a class="viewcode-back" href="../../../../tau.cf.software.html#tau.cf.software.tau_installation.TauInstallation.show_profile">[docs]</a>    <span class="k">def</span> <span class="nf">show_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">tool_name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shows profile data in the specified file or folder.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to the directory containing profile files or MULTI__ directories.</span>
<span class="sd">            tool_name (str): Name of the profile visualization tool to use, e.g. &#39;pprof&#39;.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            int: Return code of the visualization tool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Showing profile files at &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TauInstallation</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">runtime_config</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">tool_name</span><span class="p">:</span>
            <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">tool_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;paraprof&#39;</span><span class="p">,</span> <span class="s">&#39;pprof&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">tool</span><span class="p">,</span> <span class="n">path</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">tool</span><span class="p">]</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Opening </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">tool</span><span class="p">)</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">create_subprocess</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">retval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> failed&quot;</span><span class="p">,</span> <span class="n">tool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retval</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s">&quot;All visualization or reporting tools failed to open &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">,</span>
                                     <span class="s">&quot;Check Java installation, X11 installation,&quot;</span>
                                     <span class="s">&quot; network connectivity, and file permissions&quot;</span><span class="p">)</span></div></div>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2015 ParaTools, Inc..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>